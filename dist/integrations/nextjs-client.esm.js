import{useRef as e,useEffect as t,useCallback as s}from"react";var LogLevel,LogStrategy;!function(LogLevel){LogLevel[LogLevel.DEBUG=0]="DEBUG",LogLevel[LogLevel.INFO=1]="INFO",LogLevel[LogLevel.WARN=2]="WARN",LogLevel[LogLevel.ERROR=3]="ERROR",LogLevel[LogLevel.FATAL=4]="FATAL"}(LogLevel||(LogLevel={})),function(LogStrategy){LogStrategy.CONSOLE="console",LogStrategy.MEMORY="memory",LogStrategy.DATABASE="database",LogStrategy.FILE="file",LogStrategy.HYBRID="hybrid"}(LogStrategy||(LogStrategy={}));const n={strategy:"production"===process.env.NODE_ENV?LogStrategy.HYBRID:LogStrategy.CONSOLE,level:"production"===process.env.NODE_ENV?LogLevel.WARN:LogLevel.DEBUG,maxMemoryEntries:parseInt(process.env.LOG_MAX_MEMORY_ENTRIES||"1000"),maxDatabaseEntries:parseInt(process.env.LOG_MAX_DATABASE_ENTRIES||"10000"),maxFileEntries:parseInt(process.env.LOG_MAX_FILE_ENTRIES||"5000"),enableConsole:"production"!==process.env.NODE_ENV,enableDatabase:!0,enableFile:"production"===process.env.NODE_ENV,databaseTable:"error_logs",filePath:process.env.LOG_FILE_PATH||"./logs/app.log",maxFileSize:parseInt(process.env.LOG_MAX_FILE_SIZE||"10485760"),maxFiles:parseInt(process.env.LOG_MAX_FILES||"5"),format:"production"===process.env.NODE_ENV?"json":"pretty",includeStack:!0,includeMetadata:!0};class a{constructor(){this.name="console",this.config={}}configure(e){this.config=e}async log(e){if(!this.config.enableConsole)return;const t=e.timestamp.toISOString(),s=LogLevel[e.level],n=e.context?` ${JSON.stringify(e.context)}`:"",a=e.metadata?` ${JSON.stringify(e.metadata)}`:"";let r=`[${t}] ${s}: ${e.message}${n}${a}`;switch(e.error&&this.config.includeStack&&(r+=`\nError: ${e.error.message}`,e.stack&&(r+=`\nStack: ${e.stack}`)),e.level){case LogLevel.DEBUG:case LogLevel.INFO:case LogLevel.WARN:case LogLevel.ERROR:case LogLevel.FATAL:}}}class r{constructor(){this.name="memory",this.config={},this.logs=[]}configure(e){this.config=e}async log(e){this.logs.push(e);const t=this.config.maxMemoryEntries||1e3;this.logs.length>t&&(this.logs=this.logs.slice(-t))}getLogs(e){const t=this.logs.slice();return e?t.slice(-e):t}getErrorLogs(e){const t=this.logs.filter(e=>e.level>=LogLevel.ERROR);return e?t.slice(-e):t}clear(){this.logs=[]}getStats(){const e=this.logs.filter(e=>e.level>=LogLevel.ERROR).length;return{count:this.logs.length,errors:e,maxEntries:this.config.maxMemoryEntries||1e3}}}class o{constructor(e={}){this.adapters=new Map,this.config=function(e={}){return{...n,...e}}(e);const t=function(e){const t=[];return e.maxMemoryEntries&&e.maxMemoryEntries<1&&t.push("maxMemoryEntries must be greater than 0"),e.maxDatabaseEntries&&e.maxDatabaseEntries<1&&t.push("maxDatabaseEntries must be greater than 0"),e.maxFileEntries&&e.maxFileEntries<1&&t.push("maxFileEntries must be greater than 0"),e.maxFileSize&&e.maxFileSize<1024&&t.push("maxFileSize must be at least 1KB"),e.maxFiles&&e.maxFiles<1&&t.push("maxFiles must be greater than 0"),e.filePath&&!e.filePath.endsWith(".log")&&t.push("filePath should end with .log extension"),t}(this.config);if(t.length>0)throw new Error(`Invalid logger configuration: ${t.join(", ")}`);this.initializeAdapters()}static getInstance(e={}){return o.instance||(o.instance=new o(e)),o.instance}static create(e={}){return new o(e)}static reset(){o.instance&&(o.instance.cleanup(),o.instance=null)}initializeAdapters(){if(this.config.enableConsole){const e=new a;e.configure(this.config),this.adapters.set("console",e)}const e=new r;e.configure(this.config),this.adapters.set("memory",e)}shouldLog(e){return e>=this.config.level}createLogEntry(e,t,s,n,a){const r={id:this.generateId(),timestamp:new Date,level:e,message:t,context:s,error:n,metadata:a};return this.config.includeStack&&n?.stack&&(r.stack=n.stack),r}generateId(){return function(){if("undefined"!=typeof require)try{const{randomUUID:e}=require("crypto");return e()}catch{}return"undefined"!=typeof globalThis&&globalThis.crypto&&globalThis.crypto.randomUUID?globalThis.crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}()}async log(e){if(!this.shouldLog(e.level))return;const t=[];switch(this.config.strategy){case LogStrategy.CONSOLE:this.adapters.has("console")&&t.push(this.adapters.get("console").log(e));break;case LogStrategy.MEMORY:this.adapters.has("memory")&&t.push(this.adapters.get("memory").log(e));break;case LogStrategy.HYBRID:for(const s of this.adapters.values())t.push(s.log(e));break;default:this.adapters.has("memory")&&t.push(this.adapters.get("memory").log(e))}await Promise.allSettled(t)}debug(e,t,s){const n=this.createLogEntry(LogLevel.DEBUG,e,t,void 0,s);this.log(n)}info(e,t,s){const n=this.createLogEntry(LogLevel.INFO,e,t,void 0,s);this.log(n)}warn(e,t,s){const n=this.createLogEntry(LogLevel.WARN,e,t,void 0,s);this.log(n)}error(e,t,s,n){const a=this.createLogEntry(LogLevel.ERROR,e,s,t,n);this.log(a)}fatal(e,t,s,n){const a=this.createLogEntry(LogLevel.FATAL,e,s,t,n);this.log(a)}async getLogs(e,t){if(e&&this.adapters.has(e)){const s=this.adapters.get(e);if("getLogs"in s)return s.getLogs(t)}if(this.adapters.has("memory")){return this.adapters.get("memory").getLogs(t)}return[]}async getErrorLogs(e){return(await this.getLogs(void 0,e)).filter(e=>e.level>=LogLevel.ERROR)}async clearLogs(e){if(e&&this.adapters.has(e)){const t=this.adapters.get(e);"clear"in t&&await t.clear()}else for(const e of this.adapters.values())"clear"in e&&await e.clear()}getStats(){const e={memory:0,database:0,file:0,errors:0,maxMemory:this.config.maxMemoryEntries||1e3,maxDatabase:0,maxFile:0};for(const[t,s]of this.adapters)if("getStats"in s){const n=s.getStats();e[t]=n.count||0,n.errors&&(e.errors+=n.errors)}return e}updateConfig(e){this.config={...this.config,...e};for(const e of this.adapters.values())e.configure&&e.configure(this.config)}async cleanup(){for(const e of this.adapters.values())e.cleanup&&await e.cleanup()}}o.instance=null;const i="development",c="production",l=()=>process.env.NODE_ENV===i,g=()=>process.env.NODE_ENV===c;function h(n={}){const{appSlug:a,userId:r,requestId:i,logger:c,enableConsole:h=!0,enableRemote:u=!1,remoteEndpoint:d="/api/logs",strategy:m=(l()?LogStrategy.CONSOLE:LogStrategy.MEMORY),level:p=(g()?LogLevel.WARN:LogLevel.DEBUG)}=n,f=e(null);t(()=>{if("undefined"==typeof window)return;const e=c||o.getInstance({strategy:m,level:p,enableConsole:h&&(m===LogStrategy.CONSOLE||m===LogStrategy.HYBRID),enableDatabase:!1,enableFile:!1});f.current=e},[c,h]);const E=s((e,t,s,n,o)=>{if(!f.current)return;const c={...o,appSlug:a,userId:r,requestId:i,userAgent:navigator.userAgent,url:window.location.href,timestamp:(new Date).toISOString()};switch(e){case LogLevel.DEBUG:f.current.debug(t,s,c);break;case LogLevel.INFO:f.current.info(t,s,c);break;case LogLevel.WARN:f.current.warn(t,s,c);break;case LogLevel.ERROR:f.current.error(t,n,s,c);break;case LogLevel.FATAL:f.current.fatal(t,n,s,c)}u&&d&&x(e,t,s,n,c)},[a,r,i,u,d]),x=s(async(e,t,s,n,a)=>{try{await fetch(d,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({level:e,message:t,context:s,error:n?{name:n.name,message:n.message,stack:n.stack}:void 0,metadata:a})})}catch(e){}},[d]);return{debug:s((e,t,s)=>{E(LogLevel.DEBUG,e,t,void 0,s)},[E]),info:s((e,t,s)=>{E(LogLevel.INFO,e,t,void 0,s)},[E]),warn:s((e,t,s)=>{E(LogLevel.WARN,e,t,void 0,s)},[E]),error:s((e,t,s,n)=>{E(LogLevel.ERROR,e,s,t,n)},[E]),fatal:s((e,t,s,n)=>{E(LogLevel.FATAL,e,s,t,n)},[E])}}class u{constructor(e={}){const{appSlug:t,userId:s,requestId:n,logger:a,enableConsole:r=!0,enableRemote:i=!1,remoteEndpoint:c="/api/logs",strategy:l=("development"===process.env.NODE_ENV?LogStrategy.CONSOLE:LogStrategy.MEMORY),level:g=("production"===process.env.NODE_ENV?LogLevel.WARN:LogLevel.DEBUG)}=e;this.appSlug=t,this.userId=s,this.requestId=n,this.enableRemote=i,this.remoteEndpoint=c,this.logger=a||o.getInstance({strategy:l,level:g,enableConsole:r&&(l===LogStrategy.CONSOLE||l===LogStrategy.HYBRID),enableDatabase:!1,enableFile:!1})}createContext(e){return{appSlug:this.appSlug,userId:this.userId,requestId:this.requestId,userAgent:"undefined"!=typeof window?navigator.userAgent:void 0,url:"undefined"!=typeof window?window.location.href:void 0,timestamp:(new Date).toISOString(),...e}}async sendToRemote(e,t,s,n,a){if(this.enableRemote&&"undefined"!=typeof window)try{await fetch(this.remoteEndpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({level:e,message:t,context:s,error:n?{name:n.name,message:n.message,stack:n.stack}:void 0,metadata:a})})}catch(e){}}debug(e,t,s){const n=this.createContext(t);this.logger.debug(e,n,s),this.sendToRemote(LogLevel.DEBUG,e,n,void 0,s)}info(e,t,s){const n=this.createContext(t);this.logger.info(e,n,s),this.sendToRemote(LogLevel.INFO,e,n,void 0,s)}warn(e,t,s){const n=this.createContext(t);this.logger.warn(e,n,s),this.sendToRemote(LogLevel.WARN,e,n,void 0,s)}error(e,t,s,n){const a=this.createContext(s);this.logger.error(e,t,a,n),this.sendToRemote(LogLevel.ERROR,e,a,t,n)}fatal(e,t,s,n){const a=this.createContext(s);this.logger.fatal(e,t,a,n),this.sendToRemote(LogLevel.FATAL,e,a,t,n)}}function d(e={}){return new u(e)}export{LogLevel,LogStrategy,u as NextJSClientLogger,d as createNextJSClientLogger,h as useNextJSClientLogger};
//# sourceMappingURL=nextjs-client.esm.js.map
